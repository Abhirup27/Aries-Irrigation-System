var gpio = require('rpi-gpio').promise;
var gpiop =require('rpi-gpio').promise; 



gpiop.setup(29, gpiop.DIR_IN)
gpio.setup(16, gpio.DIR_OUT)
//gpio.write(16,true)

function setupALL()
{
gpio.setup(15, gpio.DIR_OUT)
}

module.exports = {
execTask: function(cb)
{
	//console.log("RUNNING")
	if(cb== 'Water Plants')
	{
		console.log("RUNNING")
		waterPlant();
	}
       else if(cb== 'Check Moisture')
	{ console.log("Checking Moisture") 
	 checkMoisture();
	}

}

};

function waterPlant()
{
	var count=0;
	setupALL();
        gpio.write(16, false)
		
    	var Interval= setInterval(function(){
			var moisture;
				if(count>=3)
				{
					clearInterval(Interval);
					gpio.write(15,true);
					gpio.write(16, true);
					gpio.destroy(function() {
					console.log('All pins unexported');
					});
					
				}
					else{
						moisture= checkMoisture();
						console.log(moisture)
						if(moisture==false)
						{
							count++;
							console.log(count);		
				}
					}
			
		},2500)
    
}
function checkMoisture()
{
	console.log("running")	
	 gpiop.read(29, function(err, value) {
        if (err) throw err;
       console.log('The value is ' + value);
	   
	return value;    

});	

}

